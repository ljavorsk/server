call mtr.add_suppression("InnoDB: New log files created");
CREATE TABLE t_aria(i INT) ENGINE ARIA;
CREATE TABLE t(i INT PRIMARY KEY) ENGINE INNODB;
BEGIN;
INSERT INTO t VALUES(2);
connect  con1,localhost,root,,;
SET GLOBAL innodb_flush_log_at_trx_commit = 1;
INSERT INTO t VALUES(1);
# Create full backup , modify table, then create incremental/differential backup
BEGIN;
INSERT INTO t VALUES(0);
DELETE FROM t WHERE i=0;
connection default;
COMMIT;
INSERT INTO t_aria VALUES
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9),
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9),
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9),
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9),
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9),
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9),
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9),
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9),
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9),
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9);
INSERT INTO t_aria SELECT * FROM t_aria;
INSERT INTO t_aria SELECT * FROM t_aria;
INSERT INTO t_aria SELECT * FROM t_aria;
INSERT INTO t_aria SELECT * FROM t_aria;
INSERT INTO t_aria SELECT * FROM t_aria;
INSERT INTO t_aria SELECT * FROM t_aria;
INSERT INTO t_aria SELECT * FROM t_aria;
INSERT INTO t_aria SELECT * FROM t_aria;
INSERT INTO t_aria SELECT * FROM t_aria;
INSERT INTO t_aria SELECT * FROM t_aria;
INSERT INTO t_aria SELECT * FROM t_aria;
SELECT * FROM t;
i
1
2
# Prepare full backup, apply incremental one
disconnect con1;
# Restore and check results
# shutdown server
# remove datadir
# xtrabackup move back
# restart server
SELECT * FROM t;
i
1
2
DROP TABLE t;
DROP TABLE t_aria;
